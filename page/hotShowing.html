<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>热映</title>
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_1076111_gfum1llshv.css">
    <link rel="stylesheet" href="../css/common/reset.css">
    <link rel="stylesheet" href="../css/common/header.css">
    <link rel="stylesheet" href="../css/movieList.css">
    <script src="../js/jquery-1.9.1.min.js"></script>
    <script src="../js/font.js"></script>
</head>
<body>
<header class="header text-center">
    热映<a href="movieSearch.html" class="iconfont iconsousuo"></a>
</header>
<div class="main" id="list"></div>
<nav class="nav clearfix text-center">
    <a href="hotShowing.html" class="item-nav active pull-left">
        <i class="iconfont iconre"></i>
        <div class="text">热映</div>
    </a>
    <a href="ranking.html" class="item-nav pull-left">
        <i class="iconfont iconpaixingbang"></i>
        <div class="text">排行</div>
    </a>
    <a href="movieSearch.html" class="item-nav pull-left">
        <i class="iconfont iconsousuo"></i>
        <div class="text">搜索</div>
    </a>
</nav>
<script>
    var num = null;
    //   start数据的开始项    count请求的条数
    function loadMovie(start,count) {
        $.ajax({
            type: 'get',
            url: 'https://api.douban.com/v2/movie/in_theaters?start=' + start + '&count=' + count,
            dataType: 'jsonp',
            success: function (data) {
                var list = data.subjects;  //电影列表
                if (list != "") {
                    for (var i = 0; i < list.length; i++) {
                    var htm = '';
                        htm += '<div class="movie-item clearfix" onclick="movieDetail(' + list[i].id + ')">' +
                            '<div class="item-img pull-left">' +
                            '<img src="' + list[i].images.small + '" alt="" onerror="javascript:this.src=\'../img/loading.gif\';">' +
                            '</div>' +
                            '<div class="item-synopsis">' +
                            '<div class="item-title">' + list[i].title + '</div>' +
                            '<div class="item-graded">';
                        var stars = list[i].rating.stars.substring(0,1);
                        for (var star = 0; star < 5; star++) {
                            if (star < stars) {
                                htm += '<span class="rating-star rating-star-medium-full"></span>';
                            } else {
                                htm += '<span class="rating-star rating-star-medium-gray"></span>';
                            }
                        }
                        htm += list[i].rating.average +
                            '</div>' +
                            '<div class="item-figure">导演：';
                        for (var d = 0; d < list[i].directors.length; d++) {
                            htm += '<span>' + list[i].directors[d].name + '</span>';
                        }
                        htm += '</div>' +
                            '<div class="item-figure">演员：';
                        for (var j = 0; j < list[i].casts.length; j++) {
                            htm += '<span>' + list[i].casts[j].name + '</span>';
                        }
                        htm += '</div>' +
                            '</div>' +
                            '</div>';
                        $("#list").append(htm);
                    }
                    num += list.length;
                }else {
                    console.log("没有更多数据了");
                }
            }
        })
    }
    loadMovie(0,20);
    // 页面滚动到底部时加载更多
    $(window).scroll(function () {
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height();
        var windowHeight = $(this).height();
        if (Math.ceil(scrollTop + windowHeight) == scrollHeight) {
            loadMovie(num,20);
        }
    });

    function movieDetail(id) {
        window.location.href = 'movieDetails.html?id=' + id
    }
</script>
</body>
</html>
